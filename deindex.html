<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—à–∏—Ñ—Ä–∞—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0f0c29;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .controls {
            border-bottom: 2px solid #333;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #00ff88;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff88;
        }

        .upload-area {
            border: 3px dashed #00ff88;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0, 255, 136, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff99;
        }

        .upload-area h3 {
            color: #00ff88;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            height: 200px;
            background: #1a1a2e;
            color: #00ff88;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 20px;
            resize: vertical;
        }

        button {
            background: linear-gradient(90deg, #00ff88, #00cc66);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.secondary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }

        .results {
            display: none;
            margin-top: 30px;
            border-top: 2px solid #333;
            padding-top: 20px;
        }

        .data-section {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .section-title {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 1.5em;
        }

        .data-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a3e;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #8899aa;
            font-weight: bold;
        }

        .data-value {
            color: #fff;
            word-break: break-all;
        }

        .data-value.ip {
            color: #ff9966;
        }

        .data-value.coords {
            color: #66ffcc;
        }

        .data-value.warning {
            color: #ff6666;
        }

        .map-link {
            color: #66aaff;
            text-decoration: none;
        }

        .map-link:hover {
            text-decoration: underline;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1em;
            color: #00ff88;
            font-weight: bold;
        }

        .stat-label {
            color: #8899aa;
            font-size: 0.9em;
        }

        .json-viewer {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            max-height: 500px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #00ff88;
        }

        pre {
            white-space: pre-wrap;
        }

        .tabs {
            display: flex;
            gap: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: #2a2a3e;
            border: none;
            color: #8899aa;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }

        .tab.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="upload-area" id="dropArea">
            <h3>–ó–ê–ì–†–£–ó–ò–¢–ï –î–ê–ù–ù–´–ï</h3>
            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ JSON —Ñ–∞–π–ª –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ</p>
            <input type="file" id="fileInput" accept=".json,.txt" style="display: none;">
        </div>

        <textarea id="jsonInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ —Å—é–¥–∞..."></textarea>

        <div class="controls">
            <div>
                <button onclick="decodeData()">–†–ê–°–®–ò–§–†–û–í–ö–ê</button>
                <button class="secondary" onclick="clearAll()">–û–ß–ò–°–¢–ò–¢–¨</button>
                <button class="secondary" onclick="exportReport()">–≠–ö–°–ü–û–†–¢ –û–¢–ß–ï–¢–ê</button>
            </div>

            <div class="tabs" id="tabs">
                <button class="tab active" onclick="switchTab('stats')">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
                <button class="tab" onclick="switchTab('details')">–î–ï–¢–ê–õ–ò</button>
                <button class="tab" onclick="switchTab('raw')">RAW JSON</button>
                <button class="tab" onclick="switchTab('map')">–ö–ê–†–¢–ê</button>
            </div>
        </div>

        <div class="results" id="results">
            <div id="statsTab" class="tab-content">
                <div class="stats" id="stats"></div>
            </div>

            <div id="detailsTab" class="tab-content" style="display: none;">
                <div id="details"></div>
            </div>

            <div id="rawTab" class="tab-content" style="display: none;">
                <div class="json-viewer">
                    <pre id="rawJson"></pre>
                </div>
            </div>

            <div id="mapTab" class="tab-content" style="display: none;">
                <div id="mapContainer" style="height: 500px; background: #1a1a2e; border-radius: 8px; padding: 20px;">
                    <p>üìç –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                    <div id="map" style="height: 100%;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const jsonInput = document.getElementById('jsonInput');
        const results = document.getElementById('results');
        const tabs = document.querySelectorAll('.tab');

        dropArea.addEventListener('click', () => fileInput.click());

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.style.background = 'rgba(0, 255, 136, 0.15)';
            dropArea.style.borderColor = '#00ff99';
        }

        function unhighlight() {
            dropArea.style.background = '';
            dropArea.style.borderColor = '';
        }

        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFileSelect, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;

            const file = files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                jsonInput.value = e.target.result;
                decodeData();
            };

            reader.readAsText(file);
        }

        function decodeData() {
            try {
                const input = jsonInput.value.trim();
                if (!input) {
                    alert('–í—Å—Ç–∞–≤—å—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ!');
                    return;
                }

                let jsonData = extractJsonFromEmail(input);

                const data = JSON.parse(jsonData);

                displayResults(data);
                results.style.display = 'block';

                results.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + error.message);
                console.error(error);
            }
        }

        function extractJsonFromEmail(text) {
            const jsonMatch = text.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                return jsonMatch[0];
            }

            if (text.startsWith('{')) {
                return text;
            }

            const collectedDataMatch = text.match(/"collected_data"\s*:\s*"([^"]+)"/);
            if (collectedDataMatch) {
                return JSON.parse(`{"collected_data": "${collectedDataMatch[1]}"}`).collected_data;
            }

            throw new Error('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—Å—Ç–µ');
        }

        function displayResults(data) {
            displayStats(data);
            displayDetails(data);
            displayRawJson(data);
            displayMap(data);
        }

        function displayStats(data) {
            const statsContainer = document.getElementById('stats');

            const stats = [
                {
                    label: 'IP –ê–î–†–ï–°',
                    value: data.location?.ipBased?.ip ?
                        `<span title="–ü–æ–ª–Ω—ã–π IP">${data.location.ipBased.ip}</span>` :
                        '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#ff9966'
                },
                {
                    label: '–ì–ï–û–õ–û–ö–ê–¶–ò–Ø',
                    value: data.capabilities?.apis?.geolocation ? '‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞' : '‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–Ω–∞',
                    color: data.capabilities?.apis?.geolocation ? '#00ff88' : '#ff6666'
                },
                {
                    label: '–¢–û–ß–ù–û–°–¢–¨',
                    value: getGeoAccuracySimple(data),
                    color: getGeoAccuracyColorSimple(data)
                },
                {
                    label: '–ë–†–ê–£–ó–ï–†',
                    value: `${data.browser?.name || ''} ${data.browser?.version ? 'v' + data.browser.version : ''}`.trim(),
                    color: '#00ff88'
                },
                {
                    label: '–û–°',
                    value: data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#667eea'
                },
                {
                    label: '–¢–ò–ü –£–°–¢–†–û–ô–°–¢–í–ê',
                    value: getDeviceType(data),
                    color: getDeviceColor(data)
                },
                {
                    label: '–ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ô',
                    value: data.projectData?.switchCount || '0',
                    color: '#ff66aa'
                },
                {
                    label: '–ß–ê–°–û–í–û–ô –ü–û–Ø–°',
                    value: data.system?.time?.timezone ?
                        data.system.time.timezone.replace('_', ' ') : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#ffcc00'
                },
                {
                    label: '–ó–ê–î–ï–†–ñ–ö–ê',
                    value: data.network?.rtt ? `${data.network.rtt} ms` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞',
                    color: data.network?.rtt < 100 ? '#00ff88' :
                        data.network?.rtt < 300 ? '#ffcc00' : '#ff6666'
                },
                {
                    label: '–Ø–ó–´–ö/–Ø–ó–´–ö–ò',
                    value: data.browser?.languages?.length ?
                        `${data.browser.language} + ${data.browser.languages.length - 1}` :
                        data.browser?.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#aa66ff'
                }
            ];

            statsContainer.innerHTML = stats.map(stat => `
            <div class="stat-box">
                <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
                <div class="stat-label">${stat.label}</div>
            </div>
            `).join('');
        }

        function displayDetails(data) {
            const detailsContainer = document.getElementById('details');

            const sections = [
                {
                    title: '–ú–ï–¢–ê-–ò–ù–§–û–†–ú–ê–¶–ò–Ø',
                    data: [
                        ['–í—Ä–µ–º—è —Å–±–æ—Ä–∞', formatDate(data.meta?.collectedAt)],
                        ['–ò—Å—Ç–æ—á–Ω–∏–∫', data.meta?.source || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü—Ä–æ–µ–∫—Ç', data.projectData?.project || '–°–ï–¢–¨'],
                        ['–¢—Ä–∏–≥–≥–µ—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏', data.projectData?.activationTrigger || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ']
                    ]
                },
                {
                    title: '–ë–†–ê–£–ó–ï–†',
                    data: [
                        ['–ë—Ä–∞—É–∑–µ—Ä', `${data.browser?.name || ''} ${data.browser?.version || ''}`],
                        ['–í–µ—Ä—Å–∏—è', data.browser?.version || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'],
                        ['User Agent', `<small>${data.browser?.userAgent?.substring(0, 80)}...</small>`],
                        ['–Ø–∑—ã–∫', data.browser?.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏', data.browser?.languages?.join(', ') || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã'],
                        ['–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞', data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ö—É–∫–∏', data.browser?.cookieEnabled ? '<span style="color:#00ff88">‚óè –í–∫–ª—é—á–µ–Ω—ã</span>' : '<span style="color:#ff6666">‚óè –í—ã–∫–ª—é—á–µ–Ω—ã</span>']
                    ]
                },
                {
                    title: '–°–ò–°–¢–ï–ú–ê',
                    data: [
                        ['–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ, px', `${data.system?.screen?.width || 0} √ó ${data.system?.screen?.height || 0}`],
                        ['–¶–≤–µ—Ç–Ω–æ—Å—Ç—å', `${data.system?.screen?.colorDepth || 0} –±–∏—Ç`],
                        ['–ü–∏–∫—Å–µ–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ', data.system?.window?.devicePixelRatio || '1'],
                        ['–Ø–¥—Ä–∞ CPU', data.system?.hardware?.hardwareConcurrency || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ü–∞–º—è—Ç—å', data.system?.hardware?.deviceMemory ? `${data.system.hardware.deviceMemory} GB` : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å', data.system?.time?.timezone || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω']
                    ]
                },
                {
                    title: '–ú–ï–°–¢–û–ü–û–õ–û–ñ–ï–ù–ò–ï',
                    data: [
                        ['IP –∞–¥—Ä–µ—Å', `<span class="data-value ip">${data.location?.ipBased?.ip || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</span>`],
                        ['–°—Ç—Ä–∞–Ω–∞', data.location?.ipBased?.country_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'],
                        ['–ì–æ—Ä–æ–¥', data.location?.ipBased?.city || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü—Ä–æ–≤–∞–π–¥–µ—Ä', data.location?.ipBased?.org || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–¢–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', getPreciseLocation(data)]
                    ]
                },
                {
                    title: '–°–ï–¢–¨',
                    data: [
                        ['–°—Ç–∞—Ç—É—Å', data.network?.online ? '<span style="color:#00ff88">‚óè –û–Ω–ª–∞–π–Ω</span>' : '<span style="color:#ff6666">‚óè –û—Ñ—Ñ–ª–∞–π–Ω</span>'],
                        ['–¢–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', data.network?.connectionType || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø', data.network?.effectiveType || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–°–∫–æ—Ä–æ—Å—Ç—å', data.network?.downlink ? `${data.network.downlink} Mbps` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞'],
                        ['–ó–∞–¥–µ—Ä–∂–∫–∞', data.network?.rtt ? `${data.network.rtt} ms` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞'],
                        ['–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞', data.network?.saveData ? '<span style="color:#ff9966">‚óè –í–∫–ª—é—á–µ–Ω–∞</span>' : '<span style="color:#8899aa">‚óè –í—ã–∫–ª—é—á–µ–Ω–∞</span>']
                    ]
                },
                {
                    title: '–í–û–ó–ú–û–ñ–ù–û–°–¢–ò',
                    data: [
                        ['–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è', formatBoolean(data.capabilities?.apis?.geolocation, 'GPS –¥–æ—Å—Ç—É–ø–µ–Ω', 'GPS –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω')],
                        ['–ö–∞–º–µ—Ä–∞/–ú–∏–∫—Ä–æ—Ñ–æ–Ω', formatBoolean(data.capabilities?.apis?.mediaDevices, '–ï—Å—Ç—å –¥–æ—Å—Ç—É–ø', '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', formatBoolean(data.capabilities?.apis?.notifications, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è')],
                        ['–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', formatBoolean(data.capabilities?.apis?.clipboard, '–î–æ—Å—Ç—É–ø–µ–Ω', '–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω')],
                        ['WebGL', formatBoolean(data.capabilities?.apis?.webGL, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <small>(3D –≥—Ä–∞—Ñ–∏–∫–∞)</small>', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è')],
                        ['Service Workers', formatBoolean(data.capabilities?.apis?.serviceWorker, '–î–æ—Å—Ç—É–ø–Ω—ã <small>(–æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)</small>', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω—ã')]
                    ]
                },
                {
                    title: '–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û',
                    data: [
                        ['–ö—É–∫–∏', formatBoolean(data.capabilities?.storage?.cookies, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è')],
                        ['LocalStorage', formatBoolean(data.capabilities?.storage?.localStorage, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ')],
                        ['SessionStorage', formatBoolean(data.capabilities?.storage?.sessionStorage, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ')],
                        ['IndexedDB', formatBoolean(data.capabilities?.storage?.indexedDB, '–î–æ—Å—Ç—É–ø–Ω–∞ <small>(–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)</small>', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–∞')],
                        ['MIME —Ç–∏–ø—ã', data.additional?.mimeTypes ? `${data.additional.mimeTypes} —Ç–∏–ø–æ–≤ <small>(–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤)</small>` : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ü–ª–∞–≥–∏–Ω—ã', data.additional?.plugins?.length ? `${data.additional.plugins.length} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ` : '–ù–µ—Ç –ø–ª–∞–≥–∏–Ω–æ–≤']
                    ]
                }
            ];

            detailsContainer.innerHTML = sections.map(section => `
                <div class="data-section">
                    <div class="section-title">
                        <span>${section.title}</span>
                    </div>
                    ${section.data.map(([label, value]) => `
                        <div class="data-row">
                            <div class="data-label">${label}</div>
                            <div class="data-value">${value}</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function displayRawJson(data) {
            document.getElementById('rawJson').textContent =
                JSON.stringify(data, null, 2);
        }

        function displayMap(data) {
            const mapContainer = document.getElementById('mapContainer');
            const mapDiv = document.getElementById('map');

            if (data.location?.precise?.latitude && data.location?.precise?.longitude) {
                const lat = data.location.precise.latitude;
                const lon = data.location.precise.longitude;
                const accuracy = data.location.precise.accuracy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

                mapContainer.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${lat}, ${lon}<br>
                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ${accuracy}<br>
                        <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=16" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ OpenStreetMap
                        </a> | 
                        <a href="https://maps.google.com/?q=${lat},${lon}" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                        </a>
                    </div>
                    <iframe 
                        width="100%" 
                        height="450" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.01}%2C${lat - 0.01}%2C${lon + 0.01}%2C${lat + 0.01}&layer=mapnik&marker=${lat}%2C${lon}">
                    </iframe>
                `;
            } else if (data.location?.ipBased?.latitude && data.location?.ipBased?.longitude) {
                const lat = data.location.ipBased.latitude;
                const lon = data.location.ipBased.longitude;

                mapContainer.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ IP:</strong> ${lat}, ${lon}<br>
                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> –ù–∏–∑–∫–∞—è (–ø–æ IP)<br>
                        <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=12" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ OpenStreetMap
                        </a>
                    </div>
                    <iframe 
                        width="100%" 
                        height="450" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.05}%2C${lat - 0.05}%2C${lon + 0.05}%2C${lat + 0.05}&layer=mapnik&marker=${lat}%2C${lon}">
                    </iframe>
                `;
            } else {
                mapContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <p style="color: #8899aa; font-size: 1.2em;">
                            üó∫Ô∏è –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç<br>
                            <small>–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –Ω—É–∂–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</small>
                        </p>
                    </div>
                `;
            }
        }

        function formatDate(isoString) {
            if (!isoString) return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            return new Date(isoString).toLocaleString('ru-RU');
        }

        function formatBoolean(value, trueText, falseText) {
            if (value === true || value === 'true') {
                return `<span style="color:#00ff88">${trueText}</span>`;
            } else if (value === false || value === 'false') {
                return `<span style="color:#ff6666">${falseText}</span>`;
            }
            return `<span style="color:#8899aa">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>`;
        }

        function getDeviceType(data) {
            const screen = data.system?.screen;
            if (!screen || !screen.width) return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';

            const width = screen.width;
            if (width < 768) return '–ú–æ–±–∏–ª—å–Ω–æ–µ';
            if (width < 992) return '–ü–ª–∞–Ω—à–µ—Ç';
            if (width < 1200) return '–ù–æ—É—Ç–±—É–∫';
            return '–î–µ—Å–∫—Ç–æ–ø';
        }

        function getDeviceColor(data) {
            const width = data.system?.screen?.width;
            if (!width) return '#8899aa';

            if (width < 768) return '#ff66aa';
            if (width < 1024) return '#ff9966';
            if (width < 1440) return '#667eea';
            if (width < 2560) return '#00ff88';
            return '#ffcc00';
        }

        function getGeoAccuracySimple(data) {
            if (data.location?.precise?.latitude) {
                const acc = data.location.precise.accuracy || '';
                if (acc.includes('–º–µ—Ç—Ä')) {
                    const meters = parseInt(acc) || 1000;
                    if (meters < 100) return '–¢–æ—á–Ω–∞—è';
                    if (meters < 500) return '–•–æ—Ä–æ—à–∞—è';
                }
                return '–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è';
            }

            if (data.location?.ipBased?.country_name) {
                return '–ü–æ IP';
            }

            if (data.location?.ipBased?.ip) {
                return '–¢–æ–ª—å–∫–æ IP';
            }

            return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        }

        function getGeoAccuracyColorSimple(data) {
            const acc = getGeoAccuracySimple(data);
            if (acc.includes('–¢–æ—á–Ω–∞—è')) return '#00ff88';
            if (acc.includes('–•–æ—Ä–æ—à–∞—è')) return '#66ffcc';
            if (acc.includes('–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è')) return '#ffcc00';
            if (acc.includes('–ü–æ IP')) return '#ff9966';
            if (acc.includes('–¢–æ–ª—å–∫–æ IP')) return '#8899aa';
            return '#ff6666';
        }

        function getLocationInfo(data) {
            if (data.location?.precise?.latitude) {
                return `
            <div style="color:#66ffcc">
                <strong>–¢–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong><br>
                ${data.location.precise.latitude}, ${data.location.precise.longitude}<br>
                <small>–¢–æ—á–Ω–æ—Å—Ç—å: ${data.location.precise.accuracy}</small>
            </div>
        `;
            } else if (data.location?.ipBased?.country_name) {
                return `
            <div style="color:#ff9966">
                <strong>–ü–æ IP:</strong><br>
                ${data.location.ipBased.country_name || ''}${data.location.ipBased.city ? ', ' + data.location.ipBased.city : ''}<br>
                <small>${data.location.ipBased.org || '–ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</small>
            </div>
        `;
            }
            return '<span style="color:#ff6666">–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ</span>';
        }

        function getPreciseLocation(data) {
            if (data.location?.precise?.latitude) {
                const lat = data.location.precise.latitude;
                const lon = data.location.precise.longitude;
                const acc = data.location.precise.accuracy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                return `
                    <span class="data-value coords">${lat}, ${lon}</span><br>
                    <small>–¢–æ—á–Ω–æ—Å—Ç—å: ${acc}</small><br>
                    <a href="https://maps.google.com/?q=${lat},${lon}" target="_blank" class="map-link">
                        üîó –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                    </a>
                `;
            }
            return '<span class="data-value warning">–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ</span>';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName + 'Tab').style.display = 'block';

            event.target.classList.add('active');
        }

        function loadSample() {
            const sampleData = {
                "meta": {
                    "collectedAt": "2024-01-15T12:30:45.123Z",
                    "source": "https://example.com",
                    "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
                },
                "browser": {
                    "name": "Chrome",
                    "version": "120.0.0.0",
                    "platform": "Win32",
                    "language": "ru-RU"
                },
                "location": {
                    "ipBased": {
                        "ip": "109.126.176.154",
                        "country_name": "Russia",
                        "city": "Moscow",
                        "org": "Some ISP"
                    },
                    "precise": {
                        "latitude": 55.7558,
                        "longitude": 37.6173,
                        "accuracy": "122 –º–µ—Ç—Ä–æ–≤"
                    }
                },
                "projectData": {
                    "switchCount": 5,
                    "project": "–°–ï–¢–¨",
                    "activationTrigger": "dark_theme_switch_limit"
                }
            };

            jsonInput.value = JSON.stringify(sampleData, null, 2);
        }

        function clearAll() {
            jsonInput.value = '';
            results.style.display = 'none';
            fileInput.value = '';
        }

        function exportReport() {
            try {
                const data = JSON.parse(extractJsonFromEmail(jsonInput.value));
                const report = generateReport(data);

                const blob = new Blob([report], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `–æ—Ç—á–µ—Ç-${Date.now()}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message);
            }
        }

        function generateReport(data) {
            return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–û—Ç—á–µ—Ç</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .data-row { display: flex; margin: 5px 0; }
        .label { font-weight: bold; width: 200px; }
        .value { flex: 1; }
    </style>
</head>
<body>
    <h1>üìä –û—Ç—á–µ—Ç</h1>
    <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${new Date().toLocaleString('ru-RU')}</p>
    
    <div class="section">
        <h2>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–í—Ä–µ–º—è —Å–±–æ—Ä–∞:</div><div class="value">${formatDate(data.meta?.collectedAt)}</div></div>
        <div class="data-row"><div class="label">IP –∞–¥—Ä–µ—Å:</div><div class="value">${data.location?.ipBased?.ip || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
        <div class="data-row"><div class="label">–ë—Ä–∞—É–∑–µ—Ä:</div><div class="value">${data.browser?.name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
    </div>
    
    <div class="section">
        <h2>üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–°—Ç—Ä–∞–Ω–∞:</div><div class="value">${data.location?.ipBased?.country_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div></div>
        <div class="data-row"><div class="label">–ì–æ—Ä–æ–¥:</div><div class="value">${data.location?.ipBased?.city || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
        <div class="data-row"><div class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</div><div class="value">${getPreciseLocation(data)}</div></div>
    </div>
    
    <div class="section">
        <h2>üíª –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–≠–∫—Ä–∞–Ω:</div><div class="value">${data.system?.screen?.width || 0} √ó ${data.system?.screen?.height || 0}</div></div>
        <div class="data-row"><div class="label">–û–°:</div><div class="value">${data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div></div>
    </div>
    
    <div class="section">
        <h2>üìÑ –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <pre>${JSON.stringify(data, null, 2)}</pre>
    </div>
</body>
</html>`;
        }

        jsonInput.addEventListener('input', () => {
            if (jsonInput.value.includes('"collected_data"')) {
                setTimeout(decodeData, 500);
            }
        });
    </script>
</body>

</html>