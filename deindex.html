<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—à–∏—Ñ—Ä–∞—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0f0c29;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .controls {
            border-bottom: 2px solid #333;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #00ff88;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff88;
        }

        .upload-area {
            border: 3px dashed #00ff88;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0, 255, 136, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff99;
        }

        .upload-area h3 {
            color: #00ff88;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            height: 200px;
            background: #1a1a2e;
            color: #00ff88;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 20px;
            resize: vertical;
        }

        button {
            background: linear-gradient(90deg, #00ff88, #00cc66);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.secondary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }

        .results {
            display: none;
            margin-top: 30px;
            border-top: 2px solid #333;
            padding-top: 20px;
        }

        .data-section {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .section-title {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a3e;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #8899aa;
            font-weight: bold;
        }

        .data-value .online-dot {
            color: #00ff88;
        }

        .data-value .offline-dot {
            color: #ff5555;
        }

        .data-value .warning-dot {
            color: #ffaa00;
        }

        .data-value .neutral-dot {
            color: #8899aa;
        }

        .map-link {
            color: #66aaff;
            text-decoration: none;
        }

        .map-link:hover {
            text-decoration: underline;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1em;
            color: #00ff88;
            font-weight: bold;
        }

        .stat-label {
            color: #8899aa;
            font-size: 0.9em;
        }

        .json-viewer {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            max-height: 500px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #00ff88;
        }

        pre {
            white-space: pre-wrap;
        }

        .tabs {
            display: flex;
            gap: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: #2a2a3e;
            border: none;
            color: #8899aa;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }

        .tab.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="upload-area" id="dropArea">
            <h3>–ó–ê–ì–†–£–ó–ò–¢–ï –î–ê–ù–ù–´–ï</h3>
            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ JSON —Ñ–∞–π–ª –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ</p>
            <input type="file" id="fileInput" accept=".json,.txt" style="display: none;">
        </div>

        <textarea id="jsonInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ —Å—é–¥–∞..."></textarea>

        <div class="controls">
            <div>
                <button onclick="decodeData()">–†–ê–°–®–ò–§–†–û–í–ö–ê</button>
                <button class="secondary" onclick="clearAll()">–û–ß–ò–°–¢–ò–¢–¨</button>
                <button class="secondary" onclick="exportReport()">–≠–ö–°–ü–û–†–¢ –û–¢–ß–ï–¢–ê</button>
            </div>

            <div class="tabs" id="tabs">
                <button class="tab active" onclick="switchTab('stats', this)">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
                <button class="tab" onclick="switchTab('details', this)">–î–ï–¢–ê–õ–ò</button>
                <button class="tab" onclick="switchTab('raw', this)">RAW JSON</button>
                <button class="tab" onclick="switchTab('map', this)">–ö–ê–†–¢–ê</button>
            </div>
        </div>

        <div class="results" id="results">
            <div id="statsTab" class="tab-content">
                <div class="stats" id="stats"></div>
            </div>

            <div id="detailsTab" class="tab-content" style="display: none;">
                <div id="details"></div>
            </div>

            <div id="rawTab" class="tab-content" style="display: none;">
                <div class="json-viewer">
                    <pre id="rawJson"></pre>
                </div>
            </div>

            <div id="mapTab" class="tab-content" style="display: none;">
                <div id="mapContainer" style="height: 500px; background: #1a1a2e; border-radius: 8px; padding: 20px;">
                    <p>üìç –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                    <div id="map" style="height: 100%;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const jsonInput = document.getElementById('jsonInput');
        const results = document.getElementById('results');
        const tabs = document.querySelectorAll('.tab');

        dropArea.addEventListener('click', () => fileInput.click());

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.style.background = 'rgba(0, 255, 136, 0.15)';
            dropArea.style.borderColor = '#00ff99';
        }

        function unhighlight() {
            dropArea.style.background = '';
            dropArea.style.borderColor = '';
        }

        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFileSelect, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;

            const file = files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                jsonInput.value = e.target.result;
                decodeData();
            };

            reader.readAsText(file);
        }

        function decodeData() {
            try {
                const input = jsonInput.value.trim();
                if (!input) {
                    alert('–í—Å—Ç–∞–≤—å—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ!');
                    return;
                }

                let jsonData = extractJsonFromEmail(input);

                const data = JSON.parse(jsonData);

                displayResults(data);
                results.style.display = 'block';

                results.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + error.message);
                console.error(error);
            }
        }

        function extractJsonFromEmail(text) {
            const jsonMatch = text.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                return jsonMatch[0];
            }

            if (text.startsWith('{')) {
                return text;
            }

            const lines = text.split('\n');
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].trim().startsWith('{')) {
                    return lines.slice(i).join('\n');
                }
            }

            throw new Error('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—Å—Ç–µ');
        }

        function displayResults(data) {
            displayStats(data);
            displayDetails(data);
            displayRawJson(data);
            displayMap(data);
        }

        function displayStats(data) {
            const statsContainer = document.getElementById('stats');

            const stats = [
                {
                    label: 'IP –ê–î–†–ï–°',
                    value: data.location?.ipBased?.ip ?
                        `<span title="–ü–æ–ª–Ω—ã–π IP">${data.location.ipBased.ip}</span>` :
                        '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#ff9966'
                },
                {
                    label: '–ì–ï–û–õ–û–ö–ê–¶–ò–Ø',
                    value: data.capabilities?.apis?.geolocation ? '–î–æ—Å—Ç—É–ø–Ω–∞' : '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞',
                    color: data.capabilities?.apis?.geolocation ? '#00ff88' : '#ff6666'
                },
                {
                    label: '–¢–û–ß–ù–û–°–¢–¨',
                    value: getGeoAccuracySimple(data),
                    color: getGeoAccuracyColorSimple(data)
                },
                {
                    label: '–ë–†–ê–£–ó–ï–†',
                    value: `${data.browser?.name || ''} ${data.browser?.version ? 'v' + data.browser.version : ''}`.trim(),
                    color: '#00ff88'
                },
                {
                    label: '–û–°',
                    value: data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#667eea'
                },
                {
                    label: '–¢–ò–ü –£–°–¢–†–û–ô–°–¢–í–ê',
                    value: getDeviceType(data),
                    color: getDeviceColor(data)
                },
                {
                    label: '–ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ô',
                    value: data.projectData?.switchCount || '0',
                    color: '#ff66aa'
                },
                {
                    label: '–ß–ê–°–û–í–û–ô –ü–û–Ø–°',
                    value: data.system?.time?.timezone ?
                        data.system.time.timezone.replace('_', ' ') : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#ffcc00'
                },
                {
                    label: '–ó–ê–î–ï–†–ñ–ö–ê',
                    value: data.network?.rtt ?
                        `${typeof data.network.rtt === 'number' ? data.network.rtt : parseInt(data.network.rtt) || 0} ms` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞',
                    color: data.network?.rtt < 100 ? '#00ff88' :
                        data.network?.rtt < 300 ? '#ffcc00' : '#ff6666'
                },
                {
                    label: '–Ø–ó–´–ö/–Ø–ó–´–ö–ò',
                    value: data.browser?.languages?.length ?
                        `${data.browser.language} + ${data.browser.languages.length - 1}` :
                        data.browser?.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                    color: '#aa66ff'
                },
                {
                    label: 'BLUETOOTH',
                    value: data.capabilities?.apis?.bluetooth ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞',
                    color: data.capabilities?.apis?.bluetooth ? '#00ff88' : '#ff6666'
                },
                {
                    label: 'USB',
                    value: data.capabilities?.apis?.usb ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞',
                    color: data.capabilities?.apis?.usb ? '#00ff88' : '#ff6666'
                }
            ];

            statsContainer.innerHTML = stats.map(stat => `
            <div class="stat-box">
                <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
                <div class="stat-label">${stat.label}</div>
            </div>
            `).join('');
        }

        function displayDetails(data) {
            const detailsContainer = document.getElementById('details');

            const sections = [
                {
                    title: '–ú–ï–¢–ê-–ò–ù–§–û–†–ú–ê–¶–ò–Ø',
                    data: [
                        ['–í—Ä–µ–º—è —Å–±–æ—Ä–∞', formatDate(data.meta?.collectedAt)],
                        ['–ò—Å—Ç–æ—á–Ω–∏–∫', data.meta?.source || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü—Ä–æ–µ–∫—Ç', data.projectData?.project || '–°–ï–¢–¨'],
                        ['–¢—Ä–∏–≥–≥–µ—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏', data.projectData?.activationTrigger || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ']
                    ]
                },
                {
                    title: '–ë–†–ê–£–ó–ï–†',
                    data: [
                        ['–ë—Ä–∞—É–∑–µ—Ä', `${data.browser?.name || ''} ${data.browser?.version || ''}`],
                        ['–í–µ—Ä—Å–∏—è', data.browser?.version || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'],
                        ['User Agent', `<small>${data.browser?.userAgent?.substring(0, 80)}...</small>`],
                        ['–Ø–∑—ã–∫', data.browser?.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏', data.browser?.languages?.join(', ') || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã'],
                        ['–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞', data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ö—É–∫–∏', formatCookies(data.browser?.cookieEnabled)],
                        ['User Agent –¥–ª–∏–Ω–∞', `${data.browser?.userAgentLength || 0} —Å–∏–º–≤–æ–ª–æ–≤`],
                        ['–ú–æ–±–∏–ª—å–Ω–æ–µ', formatBoolean(data.browser?.isMobile, '–î–∞', '–ù–µ—Ç')],
                        ['–ü–ª–∞–Ω—à–µ—Ç', formatBoolean(data.browser?.isTablet, '–î–∞', '–ù–µ—Ç')],
                        ['Chromium', formatBoolean(data.browser?.isChromium, '–î–∞', '–ù–µ—Ç')],
                        ['Edge', formatBoolean(data.browser?.isEdge, '–î–∞', '–ù–µ—Ç')],
                        ['Opera', formatBoolean(data.browser?.isOpera, '–î–∞', '–ù–µ—Ç')]
                    ]
                },
                {
                    title: '–°–ò–°–¢–ï–ú–ê',
                    data: [
                        ['–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ, px', `${data.system?.screen?.width || 0} √ó ${data.system?.screen?.height || 0}`],
                        ['–¶–≤–µ—Ç–Ω–æ—Å—Ç—å', `${data.system?.screen?.colorDepth || 0} –±–∏—Ç`],
                        ['–ü–∏–∫—Å–µ–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ', data.system?.window?.devicePixelRatio || '1'],
                        ['–Ø–¥—Ä–∞ CPU', data.system?.hardware?.hardwareConcurrency || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ü–∞–º—è—Ç—å', data.system?.hardware?.deviceMemory ? `${data.system.hardware.deviceMemory} GB` : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å', data.system?.time?.timezone || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–°–µ–Ω—Å–æ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω', formatBoolean(data.system?.hardware?.hasTouchScreen, '–î–∞', '–ù–µ—Ç')],
                        ['–¶–≤–µ—Ç–æ–≤–æ–π –æ—Ö–≤–∞—Ç', data.system?.screen?.colorGamut || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'],
                        ['HDR', formatBoolean(data.system?.screen?.hdr, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è')]
                    ]
                },
                {
                    title: '–ú–ï–°–¢–û–ü–û–õ–û–ñ–ï–ù–ò–ï',
                    data: [
                        ['IP –∞–¥—Ä–µ—Å', `<span class="data-value ip">${data.location?.ipBased?.ip || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</span>`],
                        ['–°—Ç—Ä–∞–Ω–∞', data.location?.ipBased?.country_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'],
                        ['–ì–æ—Ä–æ–¥', data.location?.ipBased?.city || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–ü—Ä–æ–≤–∞–π–¥–µ—Ä', data.location?.ipBased?.org || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–¢–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', getPreciseLocation(data)]
                    ]
                },
                {
                    title: '–°–ï–¢–¨',
                    data: [
                        ['–°—Ç–∞—Ç—É—Å', formatNetworkStatus(data.network?.online)],
                        ['–¢–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', data.network?.connectionType || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø', data.network?.effectiveType || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'],
                        ['–°–∫–æ—Ä–æ—Å—Ç—å', data.network?.downlink ? `${data.network.downlink} Mbps` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞'],
                        ['–ó–∞–¥–µ—Ä–∂–∫–∞', data.network?.rtt ? `${data.network.rtt} ms` : '–ù–µ –∏–∑–≤–µ—Å—Ç–Ω–∞'],
                        ['–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞', formatSaveData(data.network?.saveData)],
                        ['API –æ–±–Ω–∞—Ä—É–∂–µ–Ω', data.network?.detectedAPI || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'],
                        ['–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', formatBoolean(data.network?.supported, '–î–∞', '–ù–µ—Ç')]
                    ]
                },
                {
                    title: '–í–û–ó–ú–û–ñ–ù–û–°–¢–ò',
                    data: [
                        ['–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è', formatBoolean(data.capabilities?.apis?.geolocation, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–ö–∞–º–µ—Ä–∞/–ú–∏–∫—Ä–æ—Ñ–æ–Ω', formatBoolean(data.capabilities?.apis?.mediaDevices, '‚óè –î–æ—Å—Ç—É–ø–Ω–∞/–¥–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', formatBoolean(data.capabilities?.apis?.notifications, '‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', '‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è')],
                        ['–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', formatBoolean(data.capabilities?.apis?.clipboard, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['WebGL', formatBoolean(data.capabilities?.apis?.webGL, '‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <small>(3D –≥—Ä–∞—Ñ–∏–∫–∞)</small>', '‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è')],
                        ['Service Workers', formatBoolean(data.capabilities?.apis?.serviceWorker, '‚óè –î–æ—Å—Ç—É–ø–Ω—ã <small>(–æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)</small>', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['Bluetooth', formatBoolean(data.capabilities?.apis?.bluetooth, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['USB', formatBoolean(data.capabilities?.apis?.usb, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['WebXR (VR/AR)', formatBoolean(data.capabilities?.apis?.webXR, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')]
                    ]
                },
                {
                    title: '–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û',
                    data: [
                        ['–ö—É–∫–∏', formatBoolean(data.capabilities?.storage?.cookies, '‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', '‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è')],
                        ['LocalStorage', formatBoolean(data.capabilities?.storage?.localStorage, '‚óè –î–æ—Å—Ç—É–ø–Ω–æ', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['SessionStorage', formatBoolean(data.capabilities?.storage?.sessionStorage, '‚óè –î–æ—Å—Ç—É–ø–Ω–æ', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['IndexedDB', formatBoolean(data.capabilities?.storage?.indexedDB, '‚óè –î–æ—Å—Ç—É–ø–Ω–∞ <small>(–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)</small>', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–ü–ª–∞–≥–∏–Ω—ã', data.additional?.plugins?.length ? `${data.additional.plugins.length} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ` : '–ù–µ—Ç –ø–ª–∞–≥–∏–Ω–æ–≤']
                    ]
                },
                {
                    title: '–†–ê–°–®–ò–†–ï–ù–ù–´–ï',
                    data: [
                        ['WebAuthn API', getWebAuthnDetails(data.advanced?.webAuthn)],
                        ['Share API', getShareAPIDetails(data.advanced?.shareAPI)],
                        ['WebRTC', getWebRTCDetails(data.advanced?.webRTC)],
                        ['Payment API', getPaymentAPIDetails(data.advanced?.paymentAPI)],
                        ['Credentials API', getCredentialsAPIDetails(data.advanced?.credentialsAPI)],
                        ['Battery API', getBatteryDetails(data.advanced?.battery)],
                        ['Cache API', getCacheAPIInfo(data)],
                        ['Fonts API', getFontsInfoDisplay(data)],
                        ['MIME Types', getMimeTypesDisplay(data)],
                        ['WebGL', getWebGLInfoDisplay(data)]
                    ]
                },
                {
                    title: '–ü–û–í–ï–î–ï–ù–ò–ï',
                    data: [
                        ['–ì–ª—É–±–∏–Ω–∞ —Å–∫—Ä–æ–ª–ª–∞', data.behavior?.scrollDepth || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'],
                        ['–í—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ', data.behavior?.timeOnPage || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'],
                        ['–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞', data.behavior?.screenOrientation || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'],
                        ['–í–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã', data.behavior?.visibilityState || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'],
                        ['–§–æ–∫—É—Å –æ–∫–Ω–∞', data.behavior?.hasFocus ? '–í —Ñ–æ–∫—É—Å–µ' : '–ù–µ –≤ —Ñ–æ–∫—É—Å–µ']
                    ]
                },
                {
                    title: '–•–†–ê–ù–ò–õ–ò–©–ê',
                    data: [
                        ['LocalStorage', getLocalStorageDetails(data)],
                        ['SessionStorage', data.storage?.sessionStorage?.available ? `${data.storage.sessionStorage.count || 0} –∑–∞–ø–∏—Å–µ–π <span style="color:#00ff88">‚óè –î–æ—Å—Ç—É–ø–Ω–æ</span>` : formatBoolean(false, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ')],
                        ['IndexedDB', data.storage?.indexedDB?.available ? `${data.storage.indexedDB.databases?.length || 0} –±–∞–∑ <span style="color:#00ff88">‚óè –î–æ—Å—Ç—É–ø–Ω–æ</span>` : formatBoolean(false, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ')],
                        ['Cookies', data.storage?.cookies?.available ? `${data.storage.cookies.count || 0} –∫—É–∫–∏ <span style="color:#00ff88">‚óè –î–æ—Å—Ç—É–ø–Ω–æ</span>` : formatBoolean(false, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ')],
                        ['WebSQL', getWebSQLStatus(data)],
                        ['Cache API', getCacheAPIInfo(data)]
                    ]
                },
                {
                    title: '–î–ê–¢–ß–ò–ö–ò',
                    data: [
                        ['–ì–∏—Ä–æ—Å–∫–æ–ø', formatBoolean(data.sensors?.gyroscope, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä', formatBoolean(data.sensors?.accelerometer, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–î–∞—Ç—á–∏–∫ –æ—Å–≤–µ—â–µ–Ω–∏—è', formatBoolean(data.sensors?.ambientLight, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–î–∞—Ç—á–∏–∫ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è', formatBoolean(data.sensors?.proximity, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–î–∞—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è', formatBoolean(data.sensors?.deviceMotion, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è', formatBoolean(data.sensors?.deviceOrientation, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä', formatBoolean(data.sensors?.magnetometer, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')]
                    ]
                },
                {
                    title: 'BLUETOOTH –£–°–¢–†–û–ô–°–¢–í–ê',
                    data: [
                        ['–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API', formatBoolean(data.bluetooth?.available, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–î–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–µ', formatBoolean(data.bluetooth?.details?.isAvailable, '‚óè –î–∞', '‚óè –ù–µ—Ç')],
                        ['–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ', data.bluetooth?.details?.permissions || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'],
                        ['–°–æ–ø—Ä—è–∂–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', data.bluetooth?.details?.pairedDevicesCount || 0],
                        ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', formatBoolean(data.bluetooth?.details?.canScan, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', getBluetoothDevicesDisplay(data.bluetooth?.devices)]
                    ]
                },
                {
                    title: 'USB –£–°–¢–†–û–ô–°–¢–í–ê',
                    data: [
                        ['–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API', formatBoolean(data.usb?.available, '‚óè –î–æ—Å—Ç—É–ø–µ–Ω', '‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞')],
                        ['–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ', data.usb?.details?.permissionState || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'],
                        ['–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', data.usb?.details?.connectedDevicesCount || 0],
                        ['–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', getUSBDevicesDisplay(data.usb?.devices)]
                    ]
                },
                {
                    title: '–ö–ê–ú–ï–†–ê –ò –ú–ò–ö–†–û–§–û–ù',
                    data: [
                        ['–í—Å–µ–≥–æ –∫–∞–º–µ—Ä', data.media?.summary?.cameraCount || 0],
                        ['–í—Å–µ–≥–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–≤', data.media?.summary?.microphoneCount || 0],
                        ['–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞', formatBoolean(data.media?.systemInfo?.hasFrontCamera, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–¢—ã–ª–æ–≤–∞—è –∫–∞–º–µ—Ä–∞', formatBoolean(data.media?.systemInfo?.hasBackCamera, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–í–Ω–µ—à–Ω—è—è –∫–∞–º–µ—Ä–∞', formatBoolean(data.media?.systemInfo?.hasExternalCamera, '‚óè –ï—Å—Ç—å', '‚óè –ù–µ—Ç')],
                        ['–ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞', formatBoolean(data.media?.screen?.hasScreenCapture, '‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è')],
                        ['–î–µ—Ç–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤', getMediaDevicesDisplay(data.media?.devices)]
                    ]
                }
            ];

            detailsContainer.innerHTML = sections.map(section => `
                <div class="data-section">
                    <div class="section-title">
                        <span>${section.title}</span>
                    </div>
                    ${section.data.map(([label, value]) => `
                        <div class="data-row">
                            <div class="data-label">${label}</div>
                            <div class="data-value">${value}</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function displayRawJson(data) {
            document.getElementById('rawJson').textContent =
                JSON.stringify(data, null, 2);
        }

        function displayMap(data) {
            const mapContainer = document.getElementById('mapContainer');
            const mapDiv = document.getElementById('map');

            if (data.location?.precise?.latitude && data.location?.precise?.longitude) {
                const lat = data.location.precise.latitude;
                const lon = data.location.precise.longitude;
                const accuracy = data.location.precise.accuracy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

                mapContainer.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${lat}, ${lon}<br>
                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ${accuracy}<br>
                        <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=16" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ OpenStreetMap
                        </a> | 
                        <a href="https://maps.google.com/?q=${lat},${lon}" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                        </a>
                    </div>
                    <iframe 
                        width="100%" 
                        height="450" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.01}%2C${lat - 0.01}%2C${lon + 0.01}%2C${lat + 0.01}&layer=mapnik&marker=${lat}%2C${lon}">
                    </iframe>
                `;
            } else if (data.location?.ipBased?.latitude && data.location?.ipBased?.longitude) {
                const lat = data.location.ipBased.latitude;
                const lon = data.location.ipBased.longitude;

                mapContainer.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ IP:</strong> ${lat}, ${lon}<br>
                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> –ù–∏–∑–∫–∞—è (–ø–æ IP)<br>
                        <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=12" 
                           target="_blank" class="map-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –≤ OpenStreetMap
                        </a>
                    </div>
                    <iframe 
                        width="100%" 
                        height="450" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.05}%2C${lat - 0.05}%2C${lon + 0.05}%2C${lat + 0.05}&layer=mapnik&marker=${lat}%2C${lon}">
                    </iframe>
                `;
            } else {
                mapContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <p style="color: #8899aa; font-size: 1.2em;">
                            üó∫Ô∏è –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç<br>
                            <small>–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –Ω—É–∂–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</small>
                        </p>
                    </div>
                `;
            }
        }

        function getWebSQLStatus(data) {
            let webSQL = data.capabilities?.misc?.webSQL;

            if (webSQL && typeof webSQL === 'object') {
                webSQL = webSQL.available;
            }

            if (webSQL === undefined) {
                webSQL = data.advanced?.webSQL;
                if (webSQL && typeof webSQL === 'object') {
                    webSQL = webSQL.available;
                }
            }

            if (webSQL === undefined) {
                webSQL = data.storage?.webSQL?.available;
            }

            return formatBoolean(webSQL, '‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        }

        function getCacheAPIInfo(data) {
            const cacheAPI = data.advanced?.cacheAPI ||
                data.storage?.cacheAPI;

            if (!cacheAPI || !cacheAPI.available) {
                return '<span style="color:#8899aa">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</span>';
            }

            const count = cacheAPI.count || cacheAPI.caches?.length || 0;
            return `${count} –∫—ç—à–µ–π`;
        }

        function formatDate(isoString) {
            if (!isoString) return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            return new Date(isoString).toLocaleString('ru-RU');
        }

        function formatNetworkStatus(online) {
            return online ?
                '<span style="color:#00ff88">‚óè –û–Ω–ª–∞–π–Ω</span>' :
                '<span style="color:#ff5555">‚óè –û—Ñ—Ñ–ª–∞–π–Ω</span>';
        }

        function formatCookies(enabled) {
            return enabled ?
                '<span style="color:#00ff88">‚óè –í–∫–ª—é—á–µ–Ω—ã</span>' :
                '<span style="color:#ff5555">‚óè –í—ã–∫–ª—é—á–µ–Ω—ã</span>';
        }

        function formatSaveData(saveData) {
            return saveData ?
                '<span style="color:#ffaa00">‚óè –í–∫–ª—é—á–µ–Ω–∞</span>' :
                '<span style="color:#8899aa">‚óè –í—ã–∫–ª—é—á–µ–Ω–∞</span>';
        }

        function formatBoolean(value, trueText, falseText) {
            if (value === undefined || value === null) {
                return '<span style="color:#ff5555">‚óè undefined</span>';
            }

            if (value === true || value === 'true') {
                return `<span style="color:#00ff88">‚óè ${trueText}</span>`;
            } else if (value === false || value === 'false') {
                return `<span style="color:#ff5555">‚óè ${falseText}</span>`;
            }
            return `<span style="color:#8899aa">‚óè –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>`;
        }

        function getDeviceType(data) {
            const screen = data.system?.screen;
            if (!screen || !screen.width) return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';

            const width = screen.width;
            if (width < 768) return '–ú–æ–±–∏–ª—å–Ω–æ–µ';
            if (width < 992) return '–ü–ª–∞–Ω—à–µ—Ç';
            if (width < 1200) return '–ù–æ—É—Ç–±—É–∫';
            return '–î–µ—Å–∫—Ç–æ–ø';
        }

        function getDeviceColor(data) {
            const width = data.system?.screen?.width;
            if (!width) return '#8899aa';

            if (width < 768) return '#ff66aa';
            if (width < 1024) return '#ff9966';
            if (width < 1440) return '#667eea';
            if (width < 2560) return '#00ff88';
            return '#ffcc00';
        }

        function getGeoAccuracySimple(data) {
            if (data.location?.precise?.latitude) {
                const acc = data.location.precise.accuracy || '';
                if (acc.includes('–º–µ—Ç—Ä')) {
                    const meters = parseInt(acc) || 1000;
                    if (meters < 100) return '–¢–æ—á–Ω–∞—è';
                    if (meters < 500) return '–•–æ—Ä–æ—à–∞—è';
                }
                return '–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è';
            }

            if (data.location?.ipBased?.country_name) {
                return '–ü–æ IP';
            }

            if (data.location?.ipBased?.ip) {
                return '–¢–æ–ª—å–∫–æ IP';
            }

            return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        }

        function getGeoAccuracyColorSimple(data) {
            const acc = getGeoAccuracySimple(data);
            if (acc.includes('–¢–æ—á–Ω–∞—è')) return '#00ff88';
            if (acc.includes('–•–æ—Ä–æ—à–∞—è')) return '#66ffcc';
            if (acc.includes('–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è')) return '#ffcc00';
            if (acc.includes('–ü–æ IP')) return '#ff9966';
            if (acc.includes('–¢–æ–ª—å–∫–æ IP')) return '#8899aa';
            return '#ff6666';
        }

        function getPreciseLocation(data) {
            if (data.location?.precise?.latitude) {
                const lat = data.location.precise.latitude;
                const lon = data.location.precise.longitude;
                const acc = data.location.precise.accuracy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                return `
                    <span class="data-value coords">${lat}, ${lon}</span><br>
                    <small>–¢–æ—á–Ω–æ—Å—Ç—å: ${acc}</small><br>
                    <a href="https://maps.google.com/?q=${lat},${lon}" target="_blank" class="map-link">
                        üîó –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                    </a>
                `;
            }
            return '<span class="data-value warning">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</span>';
        }

        function getFontsInfoDisplay(data) {
            if (!data.advanced?.fonts?.available) {
                return '<span style="color:#8899aa">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</span>';
            }

            const fonts = data.advanced.fonts;
            if (fonts.sample && fonts.sample.length > 0) {
                const sampleText = fonts.sample.slice(0, 3).join(', ');
                const moreText = fonts.count > 3 ? ` (+${fonts.count - 3})` : '';
                return `${fonts.uniqueCount} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö${moreText}<br><small>${sampleText}</small>`;
            }

            return `${fonts.uniqueCount || fonts.count || 0} —à—Ä–∏—Ñ—Ç–æ–≤`;
        }

        function getMimeTypesDisplay(data) {
            const mimeTypes = data.advanced?.mimeTypes || data.capabilities?.mimeTypes || data.additional?.mimeTypes;

            if (!mimeTypes || !mimeTypes.available) {
                return '<span style="color:#8899aa">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</span>';
            }

            const count = mimeTypes.count || 0;

            if (mimeTypes.types && mimeTypes.types.length > 0) {
                const sampleTypes = mimeTypes.types.slice(0, 3).map(t =>
                    typeof t === 'object' ? t.type : t
                );
                const sampleText = sampleTypes.join(', ');
                const moreText = count > 3 ? ` (+${count - 3})` : '';
                return `${count} —Ç–∏–ø–æ–≤${moreText}<br><small>${sampleText}</small>`;
            }

            return `${count} —Ç–∏–ø–æ–≤`;
        }

        function getWebGLInfoDisplay(data) {
            if (!data.capabilities?.apis?.webGL) {
                return '<span style="color:#ff5555">‚óè –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';
            }

            const webglInfo = data.capabilities.webGL;
            if (webglInfo) {
                let info = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';
                if (webglInfo.vendor || webglInfo.renderer) {
                    info += '<br><small>';
                    if (webglInfo.vendor) info += `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${webglInfo.vendor.substring(0, 30)}...<br>`;
                    if (webglInfo.renderer) info += `–†–µ–Ω–¥–µ—Ä–µ—Ä: ${webglInfo.renderer.substring(0, 30)}...<br>`;
                    if (webglInfo.supportedExtensions) info += `–†–∞—Å—à–∏—Ä–µ–Ω–∏–π: ${webglInfo.supportedExtensions}`;
                    info += '</small>';
                }
                return info;
            }

            return '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';
        }

        function getBluetoothDevicesDisplay(devices) {
            if (!devices || devices.length === 0) {
                return '<span style="color:#8899aa">–ù–µ—Ç —Å–æ–ø—Ä—è–∂–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</span>';
            }

            const list = devices.map(device =>
                `<div style="margin: 5px 0; padding: 5px; background: rgba(0,100,255,0.1); border-radius: 4px;">
            <strong>${device.name}</strong><br>
            <small>ID: ${device.id}</small>
            ${device.gatt?.connected ?
                    '<small style="color:#00ff88;"> ‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–æ</small>' :
                    '<small style="color:#ff9966;"> ‚óè –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</small>'
                }
        </div>`
            ).join('');

            return `<div style="max-height: 200px; overflow-y: auto;">${list}</div>`;
        }

        function getUSBDevicesDisplay(devices) {
            if (!devices || devices.length === 0) {
                return '<span style="color:#8899aa">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö USB —É—Å—Ç—Ä–æ–π—Å—Ç–≤</span>';
            }

            const list = devices.map(device =>
                `<div style="margin: 5px 0; padding: 5px; background: rgba(0,200,100,0.1); border-radius: 4px;">
            <strong>${device.productName}</strong><br>
            <small>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${device.manufacturerName}</small><br>
            <small>VID: 0x${device.vendorId.toString(16)}, PID: 0x${device.productId.toString(16)}</small><br>
            <small>${device.usbVersion} | –°–µ—Ä–∏–π–Ω—ã–π: ${device.serialNumber}</small>
        </div>`
            ).join('');

            return `<div style="max-height: 200px; overflow-y: auto;">${list}</div>`;
        }

        function getMediaDevicesDisplay(devices) {
            if (!devices || devices.length === 0) {
                return '<span style="color:#8899aa">–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</span>';
            }

            const cameras = devices.filter(d => d.type === 'camera');
            const microphones = devices.filter(d => d.type === 'microphone');
            const speakers = devices.filter(d => d.type === 'speaker');

            let html = `<div style="max-height: 300px; overflow-y: auto;">`;

            if (cameras.length > 0) {
                html += `<h4 style="color:#00ff88; margin-top: 10px;">üìπ –ö–∞–º–µ—Ä—ã (${cameras.length}):</h4>`;
                cameras.forEach(device => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: rgba(255,100,0,0.1); border-radius: 4px;">
                <strong>${device.label}</strong>`;

                    if (device.settings) {
                        const s = device.settings;
                        html += `<br><small>${s.width}√ó${s.height} @ ${s.frameRate || '?'}fps`;
                        if (s.facingMode) html += ` | ${getFacingModeText(s.facingMode)}`;
                        html += `</small>`;
                    }

                    if (device.error) {
                        html += `<br><small style="color:#ff6666;">–û—à–∏–±–∫–∞: ${device.error}</small>`;
                    }

                    html += `</div>`;
                });
            }

            if (microphones.length > 0) {
                html += `<h4 style="color:#00ff88; margin-top: 10px;">üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω—ã (${microphones.length}):</h4>`;
                microphones.forEach(device => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: rgba(0,100,255,0.1); border-radius: 4px;">
                <strong>${device.label}</strong>
            </div>`;
                });
            }

            if (speakers.length > 0) {
                html += `<h4 style="color:#00ff88; margin-top: 10px;">üîä –ö–æ–ª–æ–Ω–∫–∏ (${speakers.length}):</h4>`;
                speakers.forEach(device => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: rgba(100,0,255,0.1); border-radius: 4px;">
                <strong>${device.label}</strong>
            </div>`;
                });
            }

            html += `</div>`;
            return html;
        }

        function getFacingModeText(mode) {
            switch (mode) {
                case 'user': return '–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è';
                case 'environment': return '–¢—ã–ª–æ–≤–∞—è';
                default: return mode;
            }
        }

        function getLocalStorageDetails(data) {
            if (!data.storage?.localStorage?.available) {
                return '<span style="color:#ff5555">‚óè –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</span>';
            }

            const ls = data.storage.localStorage;
            const count = ls.count || 0;

            if (count === 0) {
                return '<span style="color:#8899aa">0 –∑–∞–ø–∏—Å–µ–π</span>';
            }

            let html = `<strong>${count} –∑–∞–ø–∏—Å–µ–π:</strong><br>`;
            html += `<div style="max-height: 200px; overflow-y: auto; margin-top: 5px;">`;

            if (ls.data) {
                for (const [key, value] of Object.entries(ls.data)) {
                    const displayKey = key.length > 30 ? key.substring(0, 30) + '...' : key;
                    const displayValue = value && value.length > 50 ? value.substring(0, 50) + '...' : value;

                    html += `<div style="margin: 3px 0; padding: 5px; background: rgba(0,255,136,0.1); border-radius: 3px;">
                <strong style="color:#00ff88">${displayKey}</strong><br>
                <small>${displayValue || '(–ø—É—Å—Ç–æ)'}</small>
            </div>`;
                }
            } else {
                html += '<small style="color:#ff9966">–î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</small>';
            }

            html += `</div>`;
            return html;
        }

        function getWebAuthnDetails(webAuthn) {
            if (!webAuthn || webAuthn.available === false) {
                return formatBoolean(false, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }

            let html = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span><br>';
            html += '<small>';

            if (webAuthn.isU2FSupported) html += 'U2F, ';
            if (webAuthn.isCTAPSupported) html += 'CTAP, ';
            if (webAuthn.isConditionalMediation) html += '–£—Å–ª–æ–≤–Ω–∞—è –º–µ–¥–∏–∞—Ü–∏—è, ';
            if (webAuthn.isUserVerifyingPlatformAuthenticatorAvailable) html += '–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä';

            html += '</small>';
            return html;
        }

        function getShareAPIDetails(shareAPI) {
            if (!shareAPI || shareAPI.available === false) {
                return formatBoolean(false, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }

            let html = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';

            if (shareAPI.canShare !== undefined) {
                html += `<br><small>canShare: ${formatBoolean(shareAPI.canShare, '–î–∞', '–ù–µ—Ç')}`;
                if (shareAPI.canShareFiles !== undefined) {
                    html += `, –§–∞–π–ª—ã: ${formatBoolean(shareAPI.canShareFiles, '–î–∞', '–ù–µ—Ç')}`;
                }
                html += '</small>';
            }

            return html;
        }

        function getWebRTCDetails(webRTC) {
            if (!webRTC || webRTC.available === false) {
                return formatBoolean(false, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }

            let html = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';

            if (webRTC.codecs) {
                const audioCodecs = webRTC.codecs.audio?.length || 0;
                const videoCodecs = webRTC.codecs.video?.length || 0;
                html += `<br><small>–ö–æ–¥–µ–∫–∏: ${audioCodecs} –∞—É–¥–∏–æ, ${videoCodecs} –≤–∏–¥–µ–æ</small>`;
            }

            if (webRTC.stunServers > 0 || webRTC.turnServers > 0) {
                html += `<br><small>–°–µ—Ä–≤–µ—Ä—ã: ${webRTC.stunServers || 0} STUN, ${webRTC.turnServers || 0} TURN</small>`;
            }

            return html;
        }

        function getPaymentAPIDetails(paymentAPI) {
            if (!paymentAPI || paymentAPI.available === false) {
                return formatBoolean(false, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }

            let html = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';

            if (paymentAPI.supportedMethods && paymentAPI.supportedMethods.length > 0) {
                html += `<br><small>–ú–µ—Ç–æ–¥—ã: ${paymentAPI.supportedMethods.length}</small>`;
            }

            return html;
        }

        function getCredentialsAPIDetails(credentialsAPI) {
            if (!credentialsAPI || credentialsAPI.available === false) {
                return formatBoolean(false, '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }

            let html = '<span style="color:#00ff88">‚óè –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>';

            if (credentialsAPI.types) {
                const supportedTypes = [];
                if (credentialsAPI.types.password) supportedTypes.push('–ü–∞—Ä–æ–ª–∏');
                if (credentialsAPI.types.federated) supportedTypes.push('–§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ');
                if (credentialsAPI.types.publicKey) supportedTypes.push('–ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏');

                if (supportedTypes.length > 0) {
                    html += `<br><small>–¢–∏–ø—ã: ${supportedTypes.join(', ')}</small>`;
                }
            }

            return html;
        }

        function getBatteryDetails(battery) {
            if (!battery || battery.available === false) {
                return formatBoolean(false, '–î–æ—Å—Ç—É–ø–Ω–æ', '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ');
            }

            return `${battery.level} (–∑–∞—Ä—è–¥–∫–∞: ${formatBoolean(battery.charging, '–î–∞', '–ù–µ—Ç')})`;
        }

        function switchTab(tabName, clickedElement) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName + 'Tab').style.display = 'block';

            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                const tabButton = document.querySelector(`.tab[onclick*="${tabName}"]`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }
            }
        }

        function clearAll() {
            jsonInput.value = '';
            results.style.display = 'none';
            fileInput.value = '';
        }

        function exportReport() {
            try {
                const data = JSON.parse(extractJsonFromEmail(jsonInput.value));
                const report = generateReport(data);

                const blob = new Blob([report], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `–æ—Ç—á–µ—Ç-${Date.now()}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message);
            }
        }

        function generateReport(data) {
            return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–û—Ç—á–µ—Ç</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .data-row { display: flex; margin: 5px 0; }
        .label { font-weight: bold; width: 200px; }
        .value { flex: 1; }
    </style>
</head>
<body>
    <h1>üìä –û—Ç—á–µ—Ç</h1>
    <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${new Date().toLocaleString('ru-RU')}</p>
    
    <div class="section">
        <h2>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–í—Ä–µ–º—è —Å–±–æ—Ä–∞:</div><div class="value">${formatDate(data.meta?.collectedAt)}</div></div>
        <div class="data-row"><div class="label">IP –∞–¥—Ä–µ—Å:</div><div class="value">${data.location?.ipBased?.ip || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
        <div class="data-row"><div class="label">–ë—Ä–∞—É–∑–µ—Ä:</div><div class="value">${data.browser?.name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
    </div>
    
    <div class="section">
        <h2>üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–°—Ç—Ä–∞–Ω–∞:</div><div class="value">${data.location?.ipBased?.country_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div></div>
        <div class="data-row"><div class="label">–ì–æ—Ä–æ–¥:</div><div class="value">${data.location?.ipBased?.city || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div></div>
        <div class="data-row"><div class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</div><div class="value">${getPreciseLocation(data)}</div></div>
    </div>
    
    <div class="section">
        <h2>üíª –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="data-row"><div class="label">–≠–∫—Ä–∞–Ω:</div><div class="value">${data.system?.screen?.width || 0} √ó ${data.system?.screen?.height || 0}</div></div>
        <div class="data-row"><div class="label">–û–°:</div><div class="value">${data.browser?.platform || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div></div>
    </div>
    
    <div class="section">
        <h2>üìÑ –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <pre>${JSON.stringify(data, null, 2)}</pre>
    </div>
</body>
</html>`;
        }

        let decodeTimeout;
        jsonInput.addEventListener('input', () => {
            clearTimeout(decodeTimeout);
            if (jsonInput.value.includes('"collected_data"')) {
                decodeTimeout = setTimeout(decodeData, 1000);
            }
        });
    </script>
</body>

</html>